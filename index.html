async function startMonitorMode() {
  clearUI();
  pcMonitor = new RTCPeerConnection(servers);
  pcMonitor.ontrack = e => { remoteVideo.srcObject = e.streams[0]; };

  // Create video element for scanning and make it visible
  const scanVideo = document.createElement('video');
  scanVideo.setAttribute('playsinline', true);
  scanVideo.autoplay = true;
  scanVideo.muted = true;
  scanVideo.style.width = '90%';
  scanVideo.style.maxWidth = '480px';
  scanVideo.style.borderRadius = '6px';
  document.body.insertBefore(scanVideo, qrDiv); // place above QR

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    scanVideo.srcObject = stream;
    await scanVideo.play(); // ensure camera is running

    // Set canvas for scanning with willReadFrequently
    const scanCtx = scanCanvas.getContext('2d', { willReadFrequently: true });

    let scannedChunks = [];

    async function scanLoop() {
      if (scanVideo.readyState === scanVideo.HAVE_ENOUGH_DATA) {
        scanCanvas.width = scanVideo.videoWidth;
        scanCanvas.height = scanVideo.videoHeight;
        scanCtx.drawImage(scanVideo, 0, 0, scanCanvas.width, scanCanvas.height);
        const imgData = scanCtx.getImageData(0, 0, scanCanvas.width, scanCanvas.height);
        const code = jsQR(imgData.data, imgData.width, imgData.height);
        if (code) {
          scannedChunks.push(code.data);
          console.log("Scanned QR chunk", scannedChunks.length);
          alert(`Scanned chunk ${scannedChunks.length}. Scan next QR or finish.`);
          const done = confirm("Finished scanning all QR chunks?");
          if (done) {
            stream.getTracks().forEach(t => t.stop());
            scanVideo.remove();
            const fullText = scannedChunks.join('');
            applyOffer(fullText);
            return;
          }
        }
      }
      requestAnimationFrame(scanLoop);
    }

    scanLoop();
  } catch (err) {
    console.error("Camera for scanning not available:", err);
    alert("Camera not available or permission denied: " + err.message);
  }
}
